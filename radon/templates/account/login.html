{% extends "account/base.html" %}

{% load i18n %}
{% load account socialaccount %}
{% load bootstrap4 %}

{% block head_title %}{% trans "Sign In" %}{% endblock %}

{% block content %}

<script>
  var reg = new RegExp('rg:[a-zA-Z0-9]{8}:rg');
  /*
  var ml4 = {};
  ml4.opacityIn = [0,1];
  ml4.scaleIn = [0.2, 1];
  ml4.scaleOut = 3;
  ml4.durationIn = 800;
  ml4.durationOut = 600;
  ml4.delay = 500;
  */
  var step = 0;

  $(window).on("load", function(){    
    anime.timeline()
    /* .add({
      targets: '.starting-text',
      opacity: ml4.opacityIn,
      scale: ml4.scaleIn,
      duration: ml4.durationIn
    });
    */
    $(document).on("stepChange", function(){
      if(step) {
        anime({
          targets: '#step-'+(step),
          translateX: [0, -500],
          easing: 'easeInOutExpo',
          complete: function(anim) {
            $("#step-"+(step-1)).addClass("d-none");
            $("#step-"+step).removeClass("d-none");
            anime({
              targets: '#step-'+step,
              translateX: [500, 0],
              easing: 'easeInOutExpo'
            });
          }
        });
      } else {
        $("#step-1").removeClass("d-none");
        anime({
          targets: '#step-1',
          translateX: [500, 0],
          easing: 'easeInOutExpo'
        });
      }      
      step++;
    });
    $(document).trigger("stepChange");
    $(".siguiente").on('click', function(){
      $(document).trigger("stepChange");
    });
  });
</script>
<div class="row">
  <div class="col-lg-3"></div>
  <div class="col-lg-6 card p-5 text-center" style="min-height: 500px;">
    <div id="step-1" class="d-none">
      <h1 class="starting-text"><b>Correo Electrónico</b></h1>
      <input class="form-control mt-5" type="email" placeholder="Email" name="" id="email">
      <button class="btn bg-secundario mt-5 w-100 siguiente">Siguiente</button>
    </div>
    <div id="step-2" class="d-none">
      <!-- if django: Sólo para usuario normal --><h1 class="starting-text"><b>Lee el código QR</b></h1>
      <div id="scanner">
      </div>
      <label for="scannedTextMemo"><b>ID</b></label>
      <input class="form-control" type="text" name="" id="scannedTextMemo" disabled>
    </div>
    <div id="step-3" class="d-none"></div>
    <div id="step-4" class="d-none"></div>
  </div>
  <div class="col-lg-3"></div>
</div>

<!--<div class="row">
  <div class="col-lg-3"></div>
  <div class="col-lg-6 card p-5">
    <h1>{% trans "Sign In" %}</h1>
    {% get_providers as socialaccount_providers %}

    {% if socialaccount_providers %}
    <p>{% blocktrans with site.name as site_name %}Please sign in with one
    of your existing third party accounts. Or, <a href="{{ signup_url }}">sign up</a>
    for a {{ site_name }} account and sign in below:{% endblocktrans %}</p>

    <div class="socialaccount_ballot">

      <ul class="socialaccount_providers">
        {% include "socialaccount/snippets/provider_list.html" with process="login" %}
      </ul>

      <div class="login-or">{% trans 'or' %}</div>

    </div>

    {% include "socialaccount/snippets/login_extra.html" %}

    {% else %}
    <p>{% blocktrans %}If you have not created an account yet, then please
    <a href="{{ signup_url }}">sign up</a> first.{% endblocktrans %}</p>
    {% endif %}

    <form class="login" method="POST" action="{% url 'account_login' %}">
      {% csrf_token %}
      {% bootstrap_form form %}
      {% if redirect_field_value %}
      <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
      {% endif %}
      <a class="button secondaryAction" href="{% url 'account_reset_password' %}">{% trans "Forgot Password?" %}</a><br>
      <div class="w-100 text-center">
        <button class="btn btn-success bg-secundario primaryAction boton mt-3" type="submit">{% trans "Sign In" %}</button>
      </div>
    </form>
  </div>
  <div class="col-lg-3"></div>
</div> -->
<script type="text/javascript">
  function onQRCodeScanned(scannedText)
  {
    var scannedTextMemo = document.getElementById("scannedTextMemo");
    if(scannedTextMemo)
    {
      scannedTextMemo.value = scannedText;
    }
  }

  //this function will be called when JsQRScanner is ready to use
  function JsQRScannerReady()
  {
      //create a new scanner passing to it a callback function that will be invoked when
      //the scanner succesfully scan a QR code
      var jbScanner = new JsQRScanner(onQRCodeScanned);
      //reduce the size of analyzed images to increase performance on mobile devices
      jbScanner.setSnapImageMaxSize(300);
    var scannerParentElement = document.getElementById("scanner");
    if(scannerParentElement)
    {
        //append the jbScanner to an existing DOM element
      jbScanner.appendTo(scannerParentElement);
    }        
  }
</script>  
{% endblock %}
