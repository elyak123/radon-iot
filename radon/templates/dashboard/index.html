{% extends "base.html" %}

{% block content %}
<p>Selecciona una fecha:</p>
<input type="date" name="fecha" id="datepick" value="{% now 'Y-m-d' %}">
<div id="map" style="min-height: 700px;" class="mt-3"></div>
{% endblock content %}
{% block scripts %}
<script>
    var map;
    var jsonData = null;
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 13,
            center: {lng: -102.29012, lat: 21.84504}
        });
        map.data.addGeoJson(jsonData["dispositivos"]);
    }

    function CargaScript() {
      var script = document.createElement('script');
      script.src = 'http://maps.googleapis.com/maps/api/js?sensor=false&callback=initMap&key=AIzaSyCF1pVeqP7ihDYESHqcBD-te81dC-m7roI';
      document.body.appendChild(script);
    }

    function cargarJson(hoy=new Date()) {
        var str = hoy.getFullYear()+"-"+a_dos_digitos(hoy.getMonth()+1)+"-"+a_dos_digitos(hoy.getDate());
        $.when(
            $.ajax({
                url: "geojsons/"+str,
            })
        ).done(function(data){
            jsonData = data;
            CargaScript();
        })
    }

    $(window).on("load", function(){
        cargarJson();
    });

    function a_dos_digitos(valor) {
        return valor.toString().padStart(2).replace(/ /g, 0);
    }

    $("#datepick").on("change", function(evt){
        cargarJson(new Date(evt.currentTarget.value));
    });
</script>
{% endblock scripts %}

<!-- https://mail-attachment.googleusercontent.com/attachment/u/0/?ui=2&ik=4ccc17d4cf&attid=0.1&permmsgid=msg-f:1666583434964318962&th=1720e4cddd993af2&view=att&disp=safe&saddbat=ANGjdJ_mW0-akGRdF7RubujYQINK1ENkSmhvdmk-J3CaFBTgTPduTgCOvb1Lr3TP-gPQgmvRPkGI23zq-wOIi9XKWDYgyLeDeNWC7Udn_HP94i1rgyrqNVq8oxymeepok_bn0S7egOT-lA6DwK84zuL33DQK0Vb6Bm2JDwVTkVgHz4_TVrUz_LO4qGHbzYzKfFF0_PflwcWs6ph-4LgSbQzzCiBK7HCxUZpMIj8p47Mz9RoXOZLO3UFDhrOxwp6sGvTPggskcTaUJ_gywb5YLPaPhBgcEeJAJQzPhdOJwFK9fUJB2KXGWY8cfjlTc2j4h0PIWvUaZceAPdB9RL6FnALSWU2AnG26JCPEUHqlHt0RwSwQIL-mPqyMgl6Nk-9dOFGWr56n9vqGE0lOc4PTaRfc6wQn16NEO3W-l85fdFeMAO7e_9PgsQifd-g2KaDcBwKd5m0r1eLgZW8KMRyL0nP1p2JdqmoOji4cHpzSmvfRoA7phiYUp05CRcKDVO-pvLbd3RZHAN1pe_xNDCJB0zFfjYKICfgfthUekStt4tls708c_h5_lU8H86NngyR_ofTdmw8BDgS_tg-lvkq8rVuntaBbp7yPxnzNb6KmH7osBuew80mOIarVCH5Oxeai0Rrif3OGCtPZkB3JrSFm64HNJEc1SP303lKbYlNATbkcvgAd-iQNYab7HKUT5EY -->
