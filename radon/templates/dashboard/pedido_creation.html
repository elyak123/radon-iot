{% extends "base.html" %}
{% load bootstrap4 %}
{% load l10n %}
{% load rutastags %}

{% block content %}
<h2>Creci√≥n de Pedido</h2>
<h3 class="text-muted">Usuario: {{ dispositivo.usuario.first_name }} {{ dispositivo.usuario.last_name }} </h3>
<h4 class="text-muted">Semana: {{ week }}</h4>
<form class="form" method="POST">
    {% csrf_token %}
    <h3>Disponibilidad</h3>
    <div class="owl-carousel owl-theme">
        {% for pedido in pedidos %}
        <div class="item" data-nivel="{{ pedido.1 | unlocalize }}">
            <div class="p-3">
                <h5>{{ pedido.0|date:'d/m/Y' }}</h5>
                <p>{{ pedido.0|date:'l' }}</p>
                <p>Comprometido: {{ pedido.1 }}L</p>
                {% if gasera.capacidad_total %}<p>Capacidad: {{ gasera.capacidad_total|subtract:pedido.1 }}L</p>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text">$</span>
        </div>
        <input id="monto" type="number" step="0.01" min="0.00" class="form-control" placeholder="Introduzca el monto a cargar">
    </div>
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text">Litros</span>
        </div>
        <input id="cantidad" type="number" step="0.01" min="0.00" class="form-control" placeholder="Introduzca la cantidad de gas a cargar">
    </div>
    <button type="submit" class="btn btn-primary">Actualizar</button>
</form>

{% endblock content %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<script type="text/javascript">
    var factor = {{ gasera.precio_actual.precio }}; // Precio por litro.
    $("#monto").on("change keyup", function(evt){
        $("#cantidad").val((evt.target.value/factor).toFixed(2));
    });
    $("#cantidad").on("change keyup", function(evt){
        $("#monto").val((evt.target.value*factor).toFixed(2));
    });
</script>
<script type="text/javascript">
$('.owl-carousel').owlCarousel({
    loop:false,
    margin:10,
    responsive:{
        0:{
            items:1
        },
        600:{
            items:3
        },
        1000:{
            items:5
        }
    }
})
var dist = {% if gasera.capacidad_total %}{{ gasera.capacidad_total|unlocalize }}{% else %}0{% endif %} || Infinity;
var items = $(".item");
for(let i = 0; i < items.length; i++) {
    if(!items[i].dataset["nivel"])
        items[i].dataset["nivel"] = Math.floor(Math.random()*dist);
    var color = getColor (
        (parseInt(items[i].dataset["nivel"]))/dist
    );
    items[i].style["background-color"] = color;
    if(color=="#000000") {
        items[i].style["color"] = "white"
    }
}

function getColor (disponible) {
    var regla = parseInt(disponible*510);
    var azul = 0;
    var verde = regla < 255 ? 255 : (510 - regla);
    var rojo = regla < 255 ? regla : 255;
    return regla == 510 ? "#000000" :
    `#${rojo.toString(16).padStart(2).replace(/ /g,0)}${verde.toString(16).padStart(2).replace(/ /g,0)}${azul.toString(16).padStart(2).replace(/ /g,0)}`;
};

</script>
{% endblock scripts %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<style>
    .item {
        background-color: #c62828;
        color: black;
        border-radius: 5px;
        min-height: 100px;
    }
</style>
{% endblock extra_head %}
